{% load static %}
{% extends 'base.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ICT Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }
        nav.navbar {
            margin: 0 !important;
            padding: 0.5rem 1rem;
            width: 100%;
            position: fixed;   /* stays at the top */
            top: 0;
            left: 0;
            z-index: 1000;
        }
        .page-content {
            margin-top: 40px;  /*  adjust this value */
            padding: 30px;      /* adds more breathing room inside */
        }

    </style>
</head>
<body class="bg-light p-4">
    <nav class="navbar navbar-dark" style="background-color:#001F54;">
  <div class="w-100 d-flex justify-content-between align-items-center">
    
    <!-- Left side -->
    <div class="d-flex align-items-center">
      <img src="{% static 'images/tsc_logo.jpeg' %}" alt="TSC Logo" width="40" height="40"
           class="me-2"
           onerror="this.style.display='none'; document.getElementById('fallback-logo').style.display='inline-block';">

      <div id="fallback-logo" 
           style="display:none; width:40px; height:40px; border-radius:50%; background:gold; color:navy;
                  font-weight:bold; font-size:18px; line-height:40px; text-align:center; margin-right:10px;">
        TSC
      </div>

      <span class="fw-bold text-light fs-5">Teachers Service Commission</span>
    </div>

    <!-- Right side -->
    <div class="d-flex align-items-center">
      <span class="text-light me-3">
        üë§ {{ request.user.full_name }}
      </span>
      <form method="post" action="{% url 'logout' %}" style="display:inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-sm fw-bold"
        style="background-color:#FFD700; color:#001F54; border-radius:6px;">
         Logout
    </button>
</form>

    </div>
  </div>
</nav>


<div class="container mt-4">
    <h2 class="mb-4 text-center" style="color: navy;">üèõÔ∏è Overall System Admin Dashboard</h2>

    <!-- ‚úÖ Summary Section -->
    <div class="row text-center mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-light shadow-sm">
                <div class="card-body">
                    <h6>Total Requests</h6>
                    <h3>{{ total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark shadow-sm">
                <div class="card-body">
                    <h6>Pending</h6>
                    <h3>{{ pending }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-light shadow-sm">
                <div class="card-body">
                    <h6>Approved</h6>
                    <h3>{{ approved }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-light shadow-sm">
                <div class="card-body">
                    <h6>Rejected</h6>
                    <h3>{{ rejected }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚úÖ Filter Controls -->
    <form method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="">-- Filter by Status --</option>
                <option value="sent_admin">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="system" class="form-select">
                <option value="">-- Filter by System --</option>
                {% for code, name in system_choices %}
                    <option value="{{ code }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" name="date" class="form-control" />
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100">Apply Filters</button>
        </div>
    </form>
    <div class="d-flex justify-content-end mb-3">
        <a href="?export_excel=1" class="btn btn-success btn-sm me-2">üìä Export to Excel</a>
        <a href="?export_pdf=1" class="btn btn-danger btn-sm">üìÑ Export to PDF</a>
    </div>


    <!-- ‚úÖ Requests Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-light">
            All System Access Requests
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Requester</th>
                        <th>TSC No</th>
                        <th>System</th>
                        <th>Request Type</th>
                        <th>Status</th>
                        <th>Handled Date</th>
                    </tr>
                </thead>
                <tbody>
                {% for sys in requests %}
                    <tr>
                        <td>{{ sys.access_request.requester.full_name }}</td>
                        <td>{{ sys.access_request.tsc_no }}</td>
                        <td>{{ sys.get_system_display }}</td>
                        <td>{{ sys.access_request.get_request_type_display }}</td>
                        <td>
                            {% if sys.ict_status == 'approved' %}
                                <span class="badge bg-success">Approved</span>
                            {% elif sys.ict_status == 'rejected' %}
                                <span class="badge bg-danger">Rejected</span>
                            {% elif sys.ict_status == 'sent_admin' %}
                                <span class="badge bg-warning text-dark">Pending</span>
                            {% else %}
                                <span class="badge bg-secondary">Unknown</span>
                            {% endif %}
                        </td>
                        <td>{{ sys.access_request.submitted_at|date:"Y-m-d H:i" }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="6" class="text-center">No matching requests found.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

</body>